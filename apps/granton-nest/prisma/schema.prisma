// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id       Int    @id @default(autoincrement())
  email    String @unique
  name     String
  password String
  role     Role   @default(USER)

  studios            Studio[]
  projectsAsArtist   Project[] @relation("ArtistProjects")
  projectsAsProducer Project[] @relation("ProducerProjects")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Studio {
  id           String   @id @default(uuid())
  studioName   String
  location     String
  services     String[]
  pricing      Json?
  availability String

  ownerId Int
  owner   User @relation(fields: [ownerId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Project[]
}

model Project {
  id       Int           @id @default(autoincrement())
  title    String
  status   ProjectStatus @default(BOOKED)
  progress Int           @default(20)

  artistId   Int
  producerId Int
  studioId   String

  bookingRef String
  paymentRef String?

  startedAt   DateTime  @default(now())
  dueAt       DateTime // startedAt + 7 days
  completedAt DateTime?

  artist   User   @relation("ArtistProjects", fields: [artistId], references: [id])
  producer User   @relation("ProducerProjects", fields: [producerId], references: [id])
  studio   Studio @relation(fields: [studioId], references: [id])

  files ProjectFile[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProjectFile {
  id        Int           @id @default(autoincrement())
  projectId Int
  stage     ProjectStatus

  software    String // e.g. "FL Studio", "Pro Tools"
  projectPath String // local path or network path

  createdAt DateTime @default(now())

  project Project @relation(fields: [projectId], references: [id])
}

enum Role {
  SUPER_ADMIN
  DEVELOPER
  PRODUCER
  ARTIST
  USER
}

enum ProjectStatus {
  BOOKED
  FULLY_PAID
  RECORDING
  MIXING
  MASTERING
  READY
}
